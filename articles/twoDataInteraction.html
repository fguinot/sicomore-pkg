<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Illustration of sicomore function to detect interactions between 2 datasets • SIComORe</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Illustration of sicomore function to detect interactions between 2 datasets">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SIComORe</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a>
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/singleData.html">Analysis of a single data set</a>
    </li>
    <li>
      <a href="../articles/twoDataInteraction.html">Analysis of two onteracting data sets</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fguinot/sicomore-pkg">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Illustration of sicomore function to detect interactions between 2 datasets</h1>
                        <h4 class="author">SIComORe team</h4>
            
            <h4 class="date">2020-03-19</h4>
      
      
      <div class="hidden name"><code>twoDataInteraction.Rmd</code></div>

    </div>

    
    
<div id="preliminaries" class="section level2">
<h2 class="hasAnchor">
<a href="#preliminaries" class="anchor"></a>Preliminaries</h2>
<p>This vignette illustrates SICOMORE for analysis two interacting data sets.</p>
</div>
<div id="data-sets-generations" class="section level2">
<h2 class="hasAnchor">
<a href="#data-sets-generations" class="anchor"></a>Data sets generations</h2>
<div id="input-matrices-generations" class="section level3">
<h3 class="hasAnchor">
<a href="#input-matrices-generations" class="anchor"></a>Input Matrices generations</h3>
<p>Data generation goes pretty much just like in the example on an single data set (see the corresponding vignette), but two data sets are required. The sample size is common to both data sets:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">100</span></a></code></pre></div>
<p>Now, the first data set:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">## FIRST DATA</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">p1 &lt;-<span class="st"> </span><span class="dv">50</span> <span class="co"># number of variables </span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">K1 &lt;-<span class="st"> </span><span class="dv">5</span>  <span class="co"># number of groups</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">rhos &lt;-<span class="st"> </span>K1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(.<span class="dv">5</span>,.<span class="dv">95</span>) <span class="co"># correlation within groups</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">grp1.size &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Multinom.html">rmultinom</a></span>(<span class="dv">1</span>,p1,<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(p1<span class="op">/</span>K1,K1)) ## group sizes</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">Sigma1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="dv">1</span><span class="op">:</span>K1, <span class="cf">function</span>(k) <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(rhos[k],grp1.size[k],grp1.size[k]))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="st">  </span><span class="kw">bdiag</span>()</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(Sigma1) &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">grp1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(grp1.size),grp1.size)</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">X1 &lt;-<span class="st"> </span>Sigma1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="st">  </span><span class="kw">rmvnorm</span>(n, <span class="dt">sigma=</span>.) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>()</a></code></pre></div>
<p>And the second data set:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">p2 &lt;-<span class="st"> </span><span class="dv">40</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">K2 &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">rhos &lt;-<span class="st"> </span>K2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(.<span class="dv">5</span>,.<span class="dv">95</span>) <span class="co"># correlation within groups</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">grp2.size &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Multinom.html">rmultinom</a></span>(<span class="dv">1</span>,p2,<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(p2<span class="op">/</span>K2,K2)) ## group sizes</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">Sigma2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="dv">1</span><span class="op">:</span>K2, <span class="cf">function</span>(k) <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(rhos[k],grp2.size[k],grp2.size[k]))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="st">  </span><span class="kw">bdiag</span>()</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(Sigma2) &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">grp2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(grp2.size), grp2.size)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">X2 &lt;-<span class="st"> </span>Sigma2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="st">  </span><span class="kw">rmvnorm</span>(n, <span class="dt">sigma=</span>.) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>()</a></code></pre></div>
<p>We show the matrix of empirical correlation exhibiting the block structure of both matrices:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> (<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>,<span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(<span class="kw">Matrix</span>(<span class="kw"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(X1)), <span class="dt">main =</span> <span class="st">"cor(X1)"</span>)</a></code></pre></div>
<p><img src="twoDataInteraction_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/image.html">image</a></span>(<span class="kw">Matrix</span>(<span class="kw"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(X2)), <span class="dt">main =</span> <span class="st">"cor(X2)"</span>)</a></code></pre></div>
<p><img src="twoDataInteraction_files/figure-html/unnamed-chunk-4-2.png" width="672"></p>
</div>
<div id="phenotyperesponse-vector" class="section level3">
<h3 class="hasAnchor">
<a href="#phenotyperesponse-vector" class="anchor"></a>Phenotype/Response vector</h3>
<p>Generation of the response vector and vector of coefficient is a little more tricky this time</p>
<p>First, we need first to compress each input matrices,</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">simple.effects<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/rowsum.html">rowsum</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(X1), grp1)<span class="op">/</span><span class="kw"><a href="https://rdrr.io/r/base/tabulate.html">tabulate</a></span>(grp1))</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">simple.effects<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/rowsum.html">rowsum</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(X2), grp2)<span class="op">/</span><span class="kw"><a href="https://rdrr.io/r/base/tabulate.html">tabulate</a></span>(grp2))</a></code></pre></div>
<p>Then, we compute the corresponding matrix of data interaction</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">interactions &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(simple.effects<span class="fl">.2</span>), <span class="cf">function</span>(i) <span class="kw"><a href="https://rdrr.io/r/base/sweep.html">sweep</a></span>(simple.effects<span class="fl">.1</span>, <span class="dv">1</span>, simple.effects<span class="fl">.2</span>[, i], <span class="st">"*"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(cbind,.)</a></code></pre></div>
<p>The parameters in the linear model originating the response variable are chosen such that there is <span class="math inline">\(s=2\)</span> non-null interactions. The simple effect associated with these interactions are non-null too.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">s &lt;-<span class="st"> </span><span class="dv">2</span> ## number of non-null interactions</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co"># vector of true parameter at the correct level of the hierarchies</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">dim1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(simple.effects<span class="fl">.1</span>)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">dim2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(simple.effects<span class="fl">.2</span>)</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">dim.inter &lt;-<span class="st"> </span>dim1 <span class="op">*</span><span class="st"> </span>dim2</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">ind.inter &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="dv">1</span><span class="op">:</span>dim.inter, s)</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">theta.inter &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">0</span>, dim.inter)</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">theta.inter[ind.inter] &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(s, <span class="dt">min=</span><span class="dv">2</span>, <span class="dt">max=</span><span class="dv">4</span>) ## interactions : sparse</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">theta.block.inter &lt;-<span class="st"> </span><span class="kw">Matrix</span>(theta.inter, dim1, dim2)</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">ind.simple.effects &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(theta.block.inter<span class="op">!=</span><span class="dv">0</span>, <span class="dt">arr.ind=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-11" data-line-number="11">theta1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">0</span>, dim1)</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">theta1[ind.simple.effects[,<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(ind.simple.effects), <span class="dt">min=</span><span class="dv">1</span>,<span class="dt">max=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">theta2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">0</span>, dim2)</a>
<a class="sourceLine" id="cb8-14" data-line-number="14">theta2[ind.simple.effects[,<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(ind.simple.effects), <span class="dt">min=</span><span class="dv">1</span>,<span class="dt">max=</span><span class="dv">2</span>)</a></code></pre></div>
<p>Finally we can draw the response vector</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">sigma &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">epsilon &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(n) <span class="op">*</span><span class="st"> </span>sigma</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">mu &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">y &lt;-<span class="st"> </span>mu <span class="op">+</span><span class="st"> </span>interactions <span class="op">%*%</span><span class="st"> </span>theta.inter <span class="op">+</span><span class="st"> </span>simple.effects<span class="fl">.1</span> <span class="op">%*%</span><span class="st"> </span>theta1 <span class="op">+</span><span class="st"> </span>simple.effects<span class="fl">.2</span> <span class="op">%*%</span><span class="st"> </span>theta2 <span class="op">+</span><span class="st"> </span>epsilon</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">r2 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(epsilon<span class="op">^</span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>((y<span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(y))<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">r2</a></code></pre></div>
<pre><code>## [1] 0.5993635</code></pre>
</div>
</div>
<div id="adjusting-multiple-hierarchies" class="section level2">
<h2 class="hasAnchor">
<a href="#adjusting-multiple-hierarchies" class="anchor"></a>Adjusting multiple hierarchies</h2>
<p>Let us run the main <code>sicomore</code> function using Ward’s algorithm for the hierarchical clustering:</p>
<p>We can plot the most striking interactions with the method <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code> and compare with the “true” model:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">theta.full &lt;-<span class="st"> </span>theta.block.inter[<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(theta.block.inter), <span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(grp1)), </a>
<a class="sourceLine" id="cb11-2" data-line-number="2">                                <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(theta.block.inter), <span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(grp2))] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>()</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">theta.true &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span>(theta.full) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Var1, Var2, <span class="dt">fill=</span>value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">show.legend=</span><span class="ot">FALSE</span>, <span class="dt">colour =</span> <span class="st">"grey80"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_fill_gradient2</span>(<span class="dt">high =</span> <span class="st">"grey40"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Matrix of true interactions"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">'Variables in X_1'</span>, <span class="dt">y =</span> <span class="st">'Variables in X'</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_fixed</span>()</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">theta.estimated &lt;-<span class="st"> </span>res<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="dt">main=</span><span class="st">"Estimated matrix of interactions"</span>, <span class="dt">threshold=</span>.<span class="dv">05</span>)</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">cowplot<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cowplot/man/plot_grid.html">plot_grid</a></span>(theta.estimated,theta.true, <span class="dt">ncol=</span><span class="dv">2</span>)</a></code></pre></div>
<p><img src="twoDataInteraction_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
</div>
<div id="comparison-of-available-options-for-variable-selection" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-of-available-options-for-variable-selection" class="anchor"></a>Comparison of available options for variable selection</h2>
<p>To compare the 3 possible options “mlgl”,“hcar and”sicomore" in <code>selection</code>, we consider the performance in term of variable selection. So let us first define an simple function to compute basic statistics:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">getSelPerf &lt;-<span class="st"> </span><span class="cf">function</span>(theta, theta.star) {</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  ones.true &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(theta.star <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  zero.true &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(theta.star <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  ones.hat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(theta <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">  zero.hat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(theta <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">  tp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(ones.hat <span class="op">%in%</span><span class="st"> </span>ones.true)</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">  tn &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(zero.hat <span class="op">%in%</span><span class="st"> </span>zero.true)</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">  fp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(ones.hat <span class="op">%in%</span><span class="st"> </span>zero.true)</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">  fn &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(zero.hat <span class="op">%in%</span><span class="st"> </span>ones.true)</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">  <span class="cf">if</span> ((tp<span class="op">+</span>fn)<span class="op">==</span><span class="dv">0</span>) recall    &lt;-<span class="st"> </span><span class="dv">0</span> <span class="cf">else</span> recall    &lt;-<span class="st"> </span>tp<span class="op">/</span>(tp<span class="op">+</span>fn) </a>
<a class="sourceLine" id="cb12-11" data-line-number="11">  <span class="cf">if</span> ((fp<span class="op">+</span>tn)<span class="op">==</span><span class="dv">0</span>) fallout   &lt;-<span class="st"> </span><span class="dv">0</span> <span class="cf">else</span> fallout   &lt;-<span class="st"> </span>fp<span class="op">/</span>(fp<span class="op">+</span>tn) </a>
<a class="sourceLine" id="cb12-12" data-line-number="12">  <span class="cf">if</span> ((tp<span class="op">+</span>fp)<span class="op">==</span><span class="dv">0</span>) precision &lt;-<span class="st"> </span><span class="dv">0</span> <span class="cf">else</span> precision &lt;-<span class="st"> </span>tp<span class="op">/</span>(tp<span class="op">+</span>fp) </a>
<a class="sourceLine" id="cb12-13" data-line-number="13">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">recall=</span>recall, <span class="dt">fallout=</span>fallout, <span class="dt">precision=</span>precision))</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">}</a></code></pre></div>
<p>And let us compare the 3 options in <code>selection</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">out.sicomore &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sicomore.html">sicomore</a></span>(y, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(X1, X2), <span class="dt">selection=</span><span class="st">"sicomore"</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">out.mlgl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sicomore.html">sicomore</a></span>(y, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(X1, X2), <span class="dt">selection=</span><span class="st">"mlgl"</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">out.rho &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sicomore.html">sicomore</a></span>(y, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(X1, X2), <span class="dt">selection=</span><span class="st">"rho-sicomore"</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>We compute the matrix of interactions effects with the method <code>getSignificance(effect = "theta")</code> for each option:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">theta.mlgl &lt;-<span class="st"> </span>out.mlgl<span class="op">$</span><span class="kw">getSignificance</span>(<span class="dt">effect =</span> <span class="st">"theta"</span>)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">theta.rho &lt;-<span class="st"> </span>out.rho<span class="op">$</span><span class="kw">getSignificance</span>(<span class="dt">effect =</span> <span class="st">"theta"</span>)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">theta.sicomore &lt;-<span class="st"> </span>out.sicomore<span class="op">$</span><span class="kw">getSignificance</span>(<span class="dt">effect =</span> <span class="st">"theta"</span>)</a></code></pre></div>
<p>Finally we evaluate the ability to recover the true interaction term for several significance thresholds:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">seq.thres &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">len=</span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">res.sicomore &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(seq.thres, <span class="cf">function</span>(threshold) <span class="kw">getSelPerf</span>(theta.sicomore<span class="op">&gt;=</span>threshold, theta.full)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>()</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">res.mlgl &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(seq.thres, <span class="cf">function</span>(threshold) <span class="kw">getSelPerf</span>(theta.mlgl<span class="op">&gt;=</span>threshold, theta.full)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>()</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">res.rho &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(seq.thres, <span class="cf">function</span>(threshold) <span class="kw">getSelPerf</span>(theta.rho<span class="op">&gt;=</span>threshold, theta.full)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>()</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">res.df &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">method =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sicomore"</span>,<span class="st">"mlgl"</span>,<span class="st">"rho-sicomore"</span>), <span class="dt">each =</span> <span class="dv">100</span>), <span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(res.sicomore, res.mlgl, res.rho))</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">res.df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> fallout, <span class="dt">y =</span> recall, <span class="dt">color =</span> method)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="twoDataInteraction_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
</div>
<div id="comparison-of-computation-time-between-the-3-options" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-of-computation-time-between-the-3-options" class="anchor"></a>Comparison of computation time between the 3 options:</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">SICOMORE &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="kw"><a href="../reference/sicomore.html">sicomore</a></span>(y, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(X1, X2), <span class="dt">selection=</span><span class="st">"sicomore"</span>, <span class="dt">verbose=</span><span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">MLGL     &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="kw"><a href="../reference/sicomore.html">sicomore</a></span>(y, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(X1, X2), <span class="dt">selection=</span><span class="st">"mlgl"</span>, <span class="dt">verbose=</span><span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">RHO      &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="kw"><a href="../reference/sicomore.html">sicomore</a></span>(y, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(X1, X2), <span class="dt">selection=</span><span class="st">"rho-sicomore"</span>, <span class="dt">verbose=</span><span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">bench &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="kw"><a href="https://rdrr.io/r/base/eval.html">eval</a></span>(SICOMORE) , <span class="kw"><a href="https://rdrr.io/r/base/eval.html">eval</a></span>(MLGL), <span class="kw"><a href="https://rdrr.io/r/base/eval.html">eval</a></span>(RHO), <span class="dt">times =</span> <span class="dv">5</span>)</a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">autoplot</span>(bench)</a></code></pre></div>
<p><img src="twoDataInteraction_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#preliminaries">Preliminaries</a></li>
      <li><a href="#data-sets-generations">Data sets generations</a></li>
      <li><a href="#adjusting-multiple-hierarchies">Adjusting multiple hierarchies</a></li>
      <li><a href="#comparison-of-available-options-for-variable-selection">Comparison of available options for variable selection</a></li>
      <li><a href="#comparison-of-computation-time-between-the-3-options">Comparison of computation time between the 3 options:</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Christophe Ambroise, Julien Chiquet, Florent Guinot, Marie Szafranski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
